<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সব নোটিশ - দুষ্ট নারী বিবর্জিত সংগঠন</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-dark: #2980b9;     
            --primary-light: #3498db;    
            --accent: #ffffff;
            --text-dark: #2c3e50;
            --text-gray: #7f8c8d;
            --bg-body: #f8f9fa;
            --card-bg: #ffffff;
            --active-bg: #ebf5fb;
            --shadow-soft: 0 10px 30px rgba(41, 128, 185, 0.08);
            --radius-lg: 20px;
        }

body.dark-mode .form-control,
body.dark-mode .search-input,
body.dark-mode .filter-select,
body.dark-mode .cat-select {
    border-color: #555; /* Dark border in dark mode */
}
        body.dark-mode {
            --bg-body: #121212;
            --card-bg: #1e1e1e;
            --text-dark: #ecf0f1;
            --text-gray: #bdc3c7;
            --active-bg: #2c3e50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hind Siliguri', sans-serif; background-color: var(--bg-body); color: var(--text-dark); line-height: 1.6; }

        /* Navbar (Same as Members) */
        .navbar { background: linear-gradient(90deg, var(--primary-dark), var(--primary-light)); padding: 15px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .nav-brand { color: var(--accent); font-size: 1.4rem; font-weight: 700; text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .nav-menu { display: flex; gap: 20px; }
        .nav-link { color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 600; font-size: 1rem; padding: 8px 16px; border-radius: 50px; }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.2); color: var(--accent); }

        /* Layout */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; display: grid; grid-template-columns: 350px 1fr; gap: 30px; align-items: start; }

        /* Sidebar */
        .notice-sidebar { background: var(--card-bg); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow-soft); height: calc(100vh - 120px); overflow-y: auto; position: sticky; top: 90px; }
        
        /* NEW: Sidebar Header with Filter */
        .sidebar-header-area { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--primary-light); }
        .sidebar-title { font-size: 1.2rem; color: var(--primary-dark); font-weight: 700; margin-bottom: 10px; }
        
        .cat-select { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background: var(--bg-body); color: var(--text-dark); font-family: inherit; }

        .notice-list { display: flex; flex-direction: column; gap: 10px; }
        .notice-item { padding: 15px; background: var(--bg-body); border: 1px solid #eee; border-radius: 12px; cursor: pointer; transition: 0.2s; position: relative; }
        .notice-item:hover { background: var(--active-bg); border-color: var(--primary-light); transform: translateX(5px); }
        .notice-item.active { background: var(--primary-dark); color: white; border-color: var(--primary-dark); }
        .notice-item.active .notice-item-date { color: rgba(255,255,255,0.8); }

        .notice-item-title { font-weight: 600; font-size: 1rem; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .notice-item-date { font-size: 0.8rem; color: var(--text-gray); display: flex; align-items: center; gap: 5px; }

        /* Category Badges */
        .cat-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; margin-left: auto; color: white; display: inline-block; }
        .bg-urgent { background-color: #e74c3c; }
        .bg-event { background-color: #27ae60; }
        .bg-general { background-color: #95a5a6; }

        /* Main Content */
        .notice-content-area { background: var(--card-bg); border-radius: var(--radius-lg); padding: 40px; box-shadow: var(--shadow-soft); min-height: 500px; }
        .notice-detail-header { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .notice-detail-title { font-size: 2rem; color: var(--primary-dark); margin-bottom: 15px; font-weight: 700; line-height: 1.3; }
        .notice-meta { color: var(--text-gray); font-size: 0.95rem; display: flex; align-items: center; gap: 15px; }
        
        .notice-detail-image { width: 100%; max-height: 500px; object-fit: contain; border-radius: 12px; margin-bottom: 30px; background: #f8f9fa; }
        .notice-body { font-size: 1.1rem; line-height: 1.8; color: var(--text-dark); white-space: pre-wrap; }

        .no-selection { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-gray); text-align: center; padding: 40px; }
        .no-selection i { font-size: 4rem; color: #dee2e6; margin-bottom: 20px; }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
            .notice-sidebar { height: auto; max-height: 300px; position: relative; top: 0; }
        }
        @media (max-width: 768px) {
            .nav-container { flex-direction: column; gap: 15px; }
            .nav-menu { gap: 10px; flex-wrap: wrap; justify-content: center; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <i class="fas fa-shield-alt"></i> দুষ্ট নারী বিবর্জিত সংগঠন
            </a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">হোম</a>
                <a href="members.html" class="nav-link">সদস্য</a>
                <a href="notices.html" class="nav-link active">নোটিশ</a>
                <a href="admin.html" class="nav-link">অ্যাডমিন</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Sidebar -->
        <aside class="notice-sidebar">
            <div class="sidebar-header-area">
                <div class="sidebar-title">নোটিশ তালিকা</div>
                <!-- NEW: Filter Dropdown -->
                <select id="category-filter" class="cat-select">
                    <option value="all">সব নোটিশ</option>
                    <option value="urgent">জরুরি</option>
                    <option value="event">ইভেন্ট</option>
                    <option value="general">সাধারণ</option>
                </select>
            </div>
            <div class="notice-list" id="notice-list">
                <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                    <i class="fas fa-spinner fa-spin"></i> লোড হচ্ছে...
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="notice-content-area" id="main-content">
            <div id="notice-details">
                <div class="no-selection">
                    <i class="far fa-file-alt"></i>
                    <h3>নোটিশ বিস্তারিত দেখতে তালিকা থেকে সিলেক্ট করুন</h3>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCDRUXONJs2uxqDmvPWGF7KLOg5VCMDVvw",
            authDomain: "dusto-nari-songothon.firebaseapp.com",
            projectId: "dusto-nari-songothon",
            storageBucket: "dusto-nari-songothon.firebasestorage.app",
            messagingSenderId: "405042412180",
            appId: "1:405042412180:web:8ec11eb69650e3cc959281"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allNotices = [];

        // Check Dark Mode
        if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');

        async function loadNotices() {
            const noticeListContainer = document.getElementById('notice-list');
            
            try {
                const q = query(collection(db, 'notices'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);
                
                allNotices = [];
                querySnapshot.forEach((doc) => {
                    const d = doc.data();
                    allNotices.push({ id: doc.id, ...d });
                });

                renderNoticeList(allNotices);
                
                // If notices exist, show first one
                if (allNotices.length > 0 && window.innerWidth > 900) {
                    showNoticeDetail(0);
                }

            } catch (error) {
                console.error("Error loading notices:", error);
                noticeListContainer.innerHTML = '<div style="color: red; padding: 10px;">লোড করতে সমস্যা হয়েছে</div>';
            }
        }

        function renderNoticeList(notices) {
            const container = document.getElementById('notice-list');
            container.innerHTML = '';

            if (notices.length === 0) {
                container.innerHTML = '<div style="padding: 15px; text-align: center; color: #7f8c8d;">কোনো নোটিশ নেই।</div>';
                return;
            }

            notices.forEach((notice, index) => {
                const date = new Date(notice.createdAt).toLocaleDateString('bn-BD');
                const catClass = notice.category ? `bg-${notice.category}` : 'bg-general';
                const catName = notice.category === 'urgent' ? 'জরুরি' : (notice.category === 'event' ? 'ইভেন্ট' : 'সাধারণ');

                const item = document.createElement('div');
                item.className = 'notice-item';
                item.dataset.id = notice.id;
                
                // Add click event passing the specific notice object
                item.addEventListener('click', () => {
                    showNoticeDetail(notice);
                    // Highlight logic
                    document.querySelectorAll('.notice-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                });

                item.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div class="notice-item-title">${notice.title}</div>
                        <span class="cat-badge ${catClass}">${catName}</span>
                    </div>
                    <div class="notice-item-date"><i class="far fa-clock"></i> ${date}</div>
                `;
                container.appendChild(item);
            });
        }

        function showNoticeDetail(notice) {
            // Check if notice is just an index (for initial load) or object
            if (typeof notice === 'number') notice = allNotices[notice];
            if (!notice) return;

            const noticeDetails = document.getElementById('notice-details');
            
            let formattedDate = new Date(notice.createdAt).toLocaleDateString('bn-BD', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
            
            const catClass = notice.category ? `bg-${notice.category}` : 'bg-general';
            const catName = notice.category === 'urgent' ? 'জরুরি' : (notice.category === 'event' ? 'ইভেন্ট' : 'সাধারণ');

            let html = `
                <div class="notice-detail-header">
                    <span class="cat-badge ${catClass}" style="font-size: 0.9rem; padding: 5px 12px; margin-bottom: 10px;">${catName}</span>
                    <h1 class="notice-detail-title">${notice.title}</h1>
                    <div class="notice-meta">
                        <span><i class="far fa-calendar-alt"></i> প্রকাশিত: ${formattedDate}</span>
                    </div>
                </div>
            `;

            if (notice.imgSrc) {
                html += `<img src="${notice.imgSrc}" alt="${notice.title}" class="notice-detail-image">`;
            }

            html += `<div class="notice-body">${notice.details || 'বিস্তারিত তথ্য নেই।'}</div>`;
            
            noticeDetails.innerHTML = html;
            
            // Animation
            noticeDetails.style.opacity = '0';
            setTimeout(() => { noticeDetails.style.opacity = '1'; noticeDetails.style.transition = 'opacity 0.3s ease'; }, 50);

            // Mobile scroll
            if (window.innerWidth <= 900) {
                document.getElementById('main-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Filter Logic
        document.getElementById('category-filter').addEventListener('change', (e) => {
            const cat = e.target.value;
            if (cat === 'all') {
                renderNoticeList(allNotices);
            } else {
                const filtered = allNotices.filter(n => n.category === cat);
                renderNoticeList(filtered);
            }
        });

        document.addEventListener('DOMContentLoaded', loadNotices);
    </script>
</body>
</html>